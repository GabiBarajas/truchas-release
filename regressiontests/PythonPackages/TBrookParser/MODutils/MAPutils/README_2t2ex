README_2t2ex:

Component tests of the mapping from 2 Truchas XML files to an Exodus
II non-degenerate hex mesh can be performed by running the
'test_2t_to_ex_mapping.py' file in this directory.  

(Note, please do not move this script to a different location as its
position relative to the particular truchas root directory must be
preserved.)

Referring to this script, the user must provide a parameters file that
provides the following inputs. A sample parameters file is provided in
param_2t2ex.py and a template for customizing your own is provided in
params_2t2exTMPL.py. For a parameters file named params.py, the script
is invoked like this:

  > pytyon test_2t_to_ex_mapping.py -f params

Note that the '.py' suffix is not given on the command line. 
Two other command line options exist:

   -H  : print a usage and purpose message and exit
   -d  : set the debug flag

A valid parameters file is a python-syntax file contains the following
information. The file name must end in '.py'.

  1. Two directories: an <InputsDir> from which input mesh files are
     obtained; and an <OutputDir> to which script outputs are written.

  2. Two Truchas XML output file names, referred to as 'T_Sim' and
     'T_Sim2' 
     You only have to provide the file prefixes into the list
     TBprfx[]. The prefixes are expanded as needed into full names in
     the T_Sim and T_Sim2 entries. You should not have to modify them.
     These files will be looked for in the InputsDir. 
     For a prefix of <myFile>, the script will look for the file given
     by
         <InputsDir>/<myFile>_output/<myFile>.Tbrook.xml

  3. Provide an appropriate coordinate scaling factor (CSF) of the
     mesh. By default this scaling factor will be that used in the 1st
     Truchas XML file (i.e T_Sim).  If the scaling factors used in
     T_Sim and T_Sim2 are different, the user will be warned to supply
     an appropriate scaling factor.

  4. Provide the cycle numbers from T_Sim and T_Sim2 you want to use to
     generate the restart file. Note that if you provide one or more
     invalid cycle numbers, the script will print a list of viable
     cycles associated with your choices of Truchas simulations. You
     can default to the last cycle for either file by specifying [-1]
     for its cycle.

  5. Provide the name and mesh-type of an Exodus II format file
     containing the new mesh in the EXOfile DICT. This file will be
     taken from the InputsDir directory.

  (ITEM 6 IS NOT CURRENTLY USED AND IS NOT INCLUDED IN THE EXAMPLE PARAMS)
      6. A filename for a list of restart cell-centred variables and their
         mapping rules (mapRulesFile). There are 2 choices of mapping
         rules : conservative or constant preserving.  Refer to the
         exisiting 'defaultmaps.txt' (the default) file for an
         example. This file is taken from the current working
         directory, not the <InputsDir>.
     (Note: these rules could be incorporated into the params file.)
     (THIS FILE WAS NOT USED IN THE ORIGINAL SCRIPT. 
      SHOULD IT HAVE BEEN?)

Now run the script by typing (for a parameter file params.py):

    > python test_2t_to_ex_mapping.py -f params

Or to use the default parameter file (param_2t2ex.py) do this:

    > python test_2t_to_ex_mapping.py

cd into 'OutputsDir' to view the following output:

  (A). Diagnostics.txt file. This text file shows diagnostics of the
       restart variables chosen to be mapped (i.e those restart
       variables listed in 'defaultmaps.txt'). Diagnostics such as the
       average, min, max, stddev and the integral are presented for
       each variable both before and after the mapping are
       provided. Note the integral diagnostic is an important check -
       this diagnostic should be identical both before and after a
       conservative mapping. There are 2 sets of diagnostics, one
       associated with mapping from T_Sim to the Exodus II file amd
       the other associated with mapping from T_Sim2 to the Exodus II
       file.

  (B). *.restart.cycle file. A binary restart file generated, to be
       used on the new mesh, resulting from the mapping.  Note the *
       is a descriptor of the form
       'truchassim1_and_truchassim2_to_exodus file name'.  Please do
       not try and restart a simulation with this restart file with
       the current head yet.

  (C). The following ASCII GMV files : 

       (i) <TBprfx>.gmv.<CYCLE>:
           GMV files of the 2 Truchas simulations at your chosen
           cycles (i.e chosen in step 2). The names are derived from
           the two prefixes provided and the two cycle numbers
           provided. Note: if you defaulted the cycle number [-1], the
           suffix will be the actual cycle used.

      (ii) <TBprfx[0]>_and_<TBprfx[1]>_to_<EXOfile>.gmv.0:
           provides a GMV file of the new mesh and new mapped fields
           at cycle 0 (by default we set the cycle for the new mapped
           simulation=0). 



  


 

