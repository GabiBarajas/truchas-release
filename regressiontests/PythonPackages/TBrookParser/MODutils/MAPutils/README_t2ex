README_t2ex:

Component tests of the mapping from a Truchas XML file to an Exodus II
non-degenerate hex mesh can be performed by running the
'test_t_to_ex_mapping.py' file in this directory.  

(Note, please do not move this script to a different location as its
position relative to the particular truchas root directory must be
preserved.)

Referring to this script, the user must provide a parameters file that
provides the following inputs. A sample parameters file is provided in
param_t2ex.py and a template for customizing your own is provided in
params_t2exTMPL.py. For a parameters file named params.py, the script
is invoked like this:

  > pytyon test_2t_to_ex_mapping.py -f params

Note that the '.py' suffix is not given on the command line. 
Two other command line options exist:

   -H  : print a usage and purpose message and exit
   -d  : set the debug flag

A valid parameters file is a python-syntax file contains the following
information. The file name must end in '.py'.

  1. Two directories: an <InputsDir> from which input mesh files are
     obtained; and an <OutputDir> to which script outputs are written.

  2. A Truchas XML output file, referred to as 'T_Sim' 
     You only have to provide the file prefix in TBprfx. The prefix is
     expanded as needed into a full name in the T_Sim entry. You
     should not have to modify them.  This file will be looked for in
     the InputsDir. For a prefix of <myFile>, the script will look for
     the file given by

         <InputsDir>/<myFile>_output/<myFile>.Tbrook.xml

  3. Provide an appropriate coordinate scaling factor (csf) of the
     mesh. This can be defaulted to 'None' and the script will pick up
     the CSF from the XML file (if present).

  4. Provide the cycle number from the truchas simulaiton that you
     want to use. Note that if you provide an invalid cycle number,
     the script will print a list of viable cycles associated with
     your chosen Truchas simulation. You can default to the last cycle
     by specifying [-1] for the cycle.

  5. Provide the name and mesh-type of an Exodus II format file
     containing the new mesh in the EXOfile DICT. This file will be
     taken from the InputsDir directory.

  (ITEM 6 IS NOT CURRENTLY USED AND IS NOT INCLUDED IN THE EXAMPLE PARAMS)
      6. A filename for a list of restart cell-centred variables and their
         mapping rules (mapRulesFile). There are 2 choices of mapping
         rules : conservative or constant preserving.  Refer to the
         exisiting 'defaultmaps.txt' (the default) file for an
         example. This file is taken from the current working
         directory, not the <InputsDir>.
     (Note: these rules could be incorporated into the params file.)
     (THIS FILE WAS NOT USED IN THE ORIGINAL SCRIPT. 
      SHOULD IT HAVE BEEN?)

Now run the script by typing (for a parmeter file params.py):

    > python test_t_to_ex_mapping.py -f params

Or to use the default parameter file (param_t2ex.py) do this:

    > python test_t_to_ex_mapping.py

cd into 'OutputsDir' to view the following output:

  (A). Diagnostics.txt file. This text file shows diagnostics of the
       restart variables chosen to be mapped (i.e those restart
       variables listed in 'defaultmaps.txt'). Diagnostics such as the
       average, min, max, stddev and the integral are presented for
       each variable both before and after the mapping are
       provided. Note the integral diagnostic is an important check -
       this diagnostic should be identical both before and after a
       conservative mapping.

  (B). <TBprfx>_to_<exofile>.restart.<CYCLE> file. 
       A binary restart file generated, to be used on the new mesh,
       resulting from the mapping.  Please do not try and restart a
       simulation with this restart file with the current head yet.

  (C). Two ASCII GMV files :
     (i) <TBprfx>.gmv.<CYCLE>: 
         A GMV file of the original Truchas simulation at your chosen
         cycle.  The nameis derived from the XML prefix and the cycle
         number provided. Note: if you defaulted the cycle number
         [-1], the suffix will be the actual cycle used.

    (ii) <TBprfx>_to_<exofile>.gmv.<CYCLE>: 
         A GMV file of the new mesh and new mapped fields at your
         chosen cycle. Note: if you defaulted the cycle number [-1],
         the suffix will be the actual cycle used.



  


 

